<div class="quiz-attempt-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner color="primary" diameter="60"></mat-spinner>
    <p class="loading-text">Loading quiz questions...</p>
  </div>

  <!-- Quiz Content -->
  <div *ngIf="!loading && questions.length > 0" class="quiz-content">
    
    <!-- Header Section - LIGHT THEME -->
    <div class="quiz-header">
      <div class="header-top">
        <button mat-icon-button (click)="goBack()" class="back-btn" aria-label="Back">
          <svg class="icon icon-back" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M19 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H19v-2z" fill="currentColor"/>
          </svg>
        </button>

        <div class="quiz-info">
          <h1 class="quiz-title">{{ quizData.title }}</h1>
          
          <div class="info-chips">
            <div class="chip timer-chip" [class.warning]="timeRemaining < 60">
              <svg class="icon icon-clock" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 2a10 10 0 100 20 10 10 0 000-20zm1 11h-2V7h2v6zm-1 4a1 1 0 110-2 1 1 0 010 2z" fill="currentColor"/>
              </svg>
              <span>{{ timerDisplay }}</span>
            </div>

            <div class="chip">
              <svg class="icon icon-quiz" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M18 2H6a2 2 0 00-2 2v16l4-2 4 2 4-2 4 2V4a2 2 0 00-2-2zM8 6h8v2H8V6z" fill="currentColor"/>
              </svg>
              <span>{{ currentQuestionIndex + 1 }} / {{ questions.length }}</span>
            </div>

            <div class="chip score-chip">
              <svg class="icon icon-trophy" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M7 2v2a5 5 0 005 5 5 5 0 005-5V2h-2v2a3 3 0 01-6 0V2H7z" fill="currentColor"/>
              </svg>
              <span>{{ totalScore }} / {{ quizData.totalMarks }}</span>
            </div>
          </div>
        </div>
      </div>

      <mat-progress-bar 
        mode="determinate" 
        [value]="progress" 
        class="progress-bar">
      </mat-progress-bar>
    </div>

    <!-- Question Card - DARK INTERIOR -->
    <mat-card class="question-card" *ngIf="currentQuestion">
      
      <!-- Question Header - LIGHT SECTION -->
      <div class="question-header-light">
        <div class="question-number-badge">
          <span>{{ currentQuestionIndex + 1 }}</span>
        </div>

        <div class="question-info">
          <h2 class="question-text">{{ currentQuestion.questionText }}</h2>
          
          <p class="question-marks">
            <svg class="icon icon-stars" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 17.27L18.18 21 16.54 13.97 22 9.24l-7.19-.62L12 2 9.19 8.62 2 9.24l5.46 4.73L5.82 21z" fill="currentColor"/>
            </svg>
            Worth {{ currentQuestion.marks }} marks
          </p>
        </div>
      </div>

      <!-- Options Section - DARK BACKGROUND -->
      <div class="options-container-dark">
        <mat-radio-group
          [(ngModel)]="selectedAnswer"
          [disabled]="showFeedback || submitting"
          class="options-group">

          <mat-radio-button
            *ngFor="let option of currentQuestion.options; let i = index"
            [value]="option"
            class="option-radio"
            [class.selected]="selectedAnswer === option"
            [class.correct-answer]="showFeedback && lastAnswerCorrect && selectedAnswer === option"
            [class.wrong-answer]="showFeedback && !lastAnswerCorrect && selectedAnswer === option">

            <div class="option-content">
              <span class="option-label">{{ getOptionLabel(i) }}</span>
              <span class="option-text">{{ option }}</span>

              <svg *ngIf="showFeedback && lastAnswerCorrect && selectedAnswer === option"
                class="icon feedback-icon correct" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 2a10 10 0 1010 10A10 10 0 0012 2zm-1 14.59L6.41 12 8 10.59l3 3 6-6L18.59 9z" fill="currentColor"/>
              </svg>

              <svg *ngIf="showFeedback && !lastAnswerCorrect && selectedAnswer === option"
                class="icon feedback-icon wrong" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 2a10 10 0 1010 10A10 10 0 0012 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z" fill="currentColor"/>
              </svg>
            </div>
          </mat-radio-button>

        </mat-radio-group>

        <!-- Feedback Card (Inside dark area) -->
        <div 
          *ngIf="showFeedback" 
          class="feedback-card"
          [class.correct]="lastAnswerCorrect"
          [class.incorrect]="!lastAnswerCorrect">

          <svg class="icon feedback-main-icon" viewBox="0 0 24 24" aria-hidden="true">
            <path *ngIf="lastAnswerCorrect" d="M12 2a10 10 0 1010 10A10 10 0 0012 2zm-1 14.59L6.41 12 8 10.59l3 3 6-6L18.59 9z" fill="currentColor"/>
            <path *ngIf="!lastAnswerCorrect" d="M12 2a10 10 0 1010 10A10 10 0 0012 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z" fill="currentColor"/>
          </svg>

          <div class="feedback-content">
            <h3 class="feedback-title">
              {{ lastAnswerCorrect ? 'üéâ Correct Answer!' : '‚ùå Incorrect Answer' }}
            </h3>
            <p class="feedback-text">
              {{ lastAnswerCorrect 
                ? 'Great job! You earned ' + lastMarksAwarded + ' marks.' 
                : 'Don\'t worry! The correct answer is shown above.' }}
            </p>
            <div class="marks-display">
              <span class="marks-earned">+{{ lastMarksAwarded }}</span>
              <span class="marks-total">/ {{ currentQuestion.marks }} marks</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons - LIGHT SECTION -->
      <div class="action-buttons">
        <!-- Submit Answer Button -->
        <button
          *ngIf="!showFeedback"
          mat-raised-button
          color="primary"
          (click)="submitAnswer()"
          [disabled]="!selectedAnswer || submitting"
          class="action-btn submit-btn">
          <span>{{ submitting ? 'Submitting...' : 'Submit Answer' }}</span>
          <svg *ngIf="!submitting" class="icon icon-send" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M2 21l21-9L2 3v7l15 2-15 2v7z" fill="currentColor"/>
          </svg>
          <mat-spinner *ngIf="submitting" diameter="20" class="btn-spinner"></mat-spinner>
        </button>

        <!-- Next Question Button -->
        <button
          *ngIf="showFeedback && !isLastQuestion"
          mat-raised-button
          color="accent"
          (click)="nextQuestion()"
          class="action-btn next-btn">
          <span>Next Question</span>
          <svg class="icon icon-forward" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 4l-1.41 1.41L15.17 10H4v2h11.17l-4.58 4.59L12 18l8-8-8-8z" fill="currentColor"/>
          </svg>
        </button>

        <!-- Submit Quiz Button -->
        <button
          *ngIf="showFeedback && isLastQuestion"
          mat-raised-button
          color="warn"
          (click)="submitQuiz()"
          [disabled]="submitting"
          class="action-btn final-submit-btn">
          <span>{{ submitting ? 'Finalizing...' : 'See Final Results' }}</span>
          <mat-spinner *ngIf="submitting" diameter="20" class="btn-spinner"></mat-spinner>
          <svg *ngIf="!submitting" class="icon icon-trophy-small" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M7 2v2a5 5 0 005 5 5 5 0 005-5V2h-2v2a3 3 0 01-6 0V2H7z" fill="currentColor"/>
          </svg>
        </button>
      </div>

    </mat-card>
  </div>

  <!-- Error State -->
  <div *ngIf="!loading && questions.length === 0" class="error-container">
    <svg class="icon icon-error" viewBox="0 0 24 24" aria-hidden="true">
      <path d="M11 15h2v2h-2v-2zm0-8h2v6h-2V7zm1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z" fill="currentColor"/>
    </svg>
    <h2>No Questions Available</h2>
    <p>This quiz doesn't have any questions yet.</p>
    <button mat-raised-button color="primary" (click)="goBack()">
      <svg class="icon icon-back" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M19 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H19v-2z" fill="currentColor"/>
      </svg>
      Back to Quiz List
    </button>
  </div>
</div>